defaults:
  - _self_
  - override hydra/launcher: submitit_slurm

hydra:
  run:
    dir: plan_outputs/${now:%Y-%m-%d-%H-%M-%S}
  sweep:
    dir: plan_outputs/${now:%Y-%m-%d-%H-%M-%S}
    subdir: ${hydra.job.num}
  launcher:
    submitit_folder: ${hydra.sweep.dir}/.submitit/%j
    nodes: 1
    tasks_per_node: 1
    cpus_per_task: 16
    mem_gb: 256
    gres: "gpu:h100:1"
    qos: "explore"
    timeout_min: 720
    setup: ["export DEBUGVAR=$(scontrol show hostnames $SLURM_JOB_NODELIST)",
            export MASTER_ADDR="$(scontrol show hostnames $SLURM_JOB_NODELIST | head -n 1)",
            "export MASTER_PORT=$(for port in $(shuf -i 30000-65500 -n 20); do if [[ $(netstat -tupln 2>&1 | grep $port | wc -l) -eq 0 ]] ; then echo $port; break; fi; done;)",]

# model to load for planning
ckpt_base_path:   # put absolute path here. Checkpoints will be loaded from ${ckpt_base_path}/outputs
model_name: null
model_epoch: latest

seed: 0
n_evals: 100
goal_source: 'dset'
goal_H: 5 
n_plot_samples: 0
use_action_encoder: false   # True for baseline
use_lam: true   # false for raw, true for discrete and latent
use_vq: false   #  false for raw, true for discrete
is_training: false # always false 
plan_action_type: "latent"  # "raw" or "latent" or "discrete" | raw = baseline, always run with use_action_encoder=True
use_e: true
use_z: true
use_delta: false
debug_dset_init: False

objective:
  _target_: planning.objectives.create_objective_fn
  alpha: 1
  base: 2
  mode: last

planner:
    _target_: planning.cem.CEMPlanner
    horizon: 5
    topk: 30
    num_samples: 300
    var_scale: 1
    opt_steps: 10
    eval_every: 1
    latent_prior_mu: ${latent_prior.mu}
    latent_prior_sigma: ${latent_prior.sigma}
    latent_prior_k: ${latent_prior.k}
    latent_prior_lambda: ${latent_prior.lambda}
    use_prior_sampling: ${latent_prior.use_prior_sampling}
    pseudocount: 1.0
    momentum: 0.7
    min_prob: 0.001
    init_smoothing: 0.05
    sample_temperature: 1.5
    use_mode_as_first_sample: false
    return_mode: false
name: mpc_cem

latent_prior:
  mu: [1.2093521356582642, 0.8431241512298584, -0.07732027024030685, -0.7956966161727905, 0.5090869665145874, -0.5582107305526733, -1.4233371019363403, -0.2987518608570099, -0.8013004660606384, -0.19971542060375214, 0.7263640761375427, -0.5008895993232727, 2.044449806213379, 0.2844681143760681, -0.3609921932220459, -0.34612369537353516, 0.6960288882255554, 0.26906853914260864, -1.2844648361206055, -0.3209661841392517, 0.31071901321411133, 0.09792561829090118, -1.2627184391021729, -0.5025291442871094, 0.0959562435746193, 0.18652477860450745, -0.91758793592453, -1.6547666788101196, -1.6426249742507935, 1.384456992149353, -0.5699878931045532, 0.39378291368484497]
  sigma: [2.4339778423309326, 2.1747734546661377, 2.4550693035125732, 2.6417908668518066, 1.918797254562378, 1.8143250942230225, 2.583888053894043, 2.224116086959839, 2.3469138145446777, 1.9149528741836548, 1.9120911359786987, 2.379084348678589, 2.6397788524627686, 2.4062576293945312, 2.6408543586730957, 1.9532814025878906, 2.0908091068267822, 2.526455879211426, 2.3224289417266846, 1.9208111763000488, 2.25942325592041, 1.7573902606964111, 3.0813417434692383, 2.201544761657715, 2.5638206005096436, 1.9218405485153198, 2.978853225708008, 2.537407636642456, 3.5584089756011963, 2.1698148250579834, 2.5365731716156006, 2.0478522777557373]
  k: 1.5
  lambda: 0.5
  use_prior_sampling: true